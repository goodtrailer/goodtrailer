---
layout: post
categories: work
title: CSE 168 Final Project
assets: /assets/2024-05-29-cse168-hw5/
hidden: true
katex: true
---

## Transmission

I implemented transmission using the GGX microfacet model[^1]. The relevant command is `transmission`. Note that there is no specific `ior` command because the index of refraction is actually automatically determined from the `specular` value, according to Schlick's approximation[^2]. Essentially, the value given in `specular` is the color seen when directly looking at the object, which allows us to solve for the index of refraction $\eta$. For example, glass has the index of refraction $\eta_\text{glass} = 1.5$. Using Schlick's approximation, this roughly translates to a specular value $k_s = 0.04$.

In order to conserve energy, I have the following setup: first calculate the amount of specular reflection (e.g. the Fresnel term $F_r$), and then take $1 - F_r$ to be the remaining amount. This is then distributed among diffusion and transmission. Therefore `diffuse` and `transmittance` actually represent the percentage of the *remaining* energy that is diffused/transmitted. As long as `diffuse + transmittance \leqslant 1`, energy does not increase.

Also, I did not use Schlick's approximation to compute the $F_r$, despite using it to approximate $\eta$. When it came time to actually compute $F_r$, I instead went with the full formula described in the GGX paper[^1]. Originally I had not planned to do so, but there is a reason for this: Schlick's approximation does not account for total internal reflection (TIR). It *always* interpolates over the full interval $\theta \in [0, 1]$, rather than maxing out at $1$ at an earlier value for $\theta$. However, how TIR actually works is that we should see a smooth fade between the refraction and reflection terms. At the TIR critical angle, there should not be a sharp visual effect caused by suddenly discarding invalid rays, because we should have $F_r = 1$by that point.

The following image best illustrates my implementation of transmission.

<a name="ggx-mis-256spp"></a>
![]({{page.assets}}ggx-mis-256spp.png){:.figure}
*GGX spheres and planes: The sphere on the left has `specular 0.04 0.04 0.04`, the plane in themiddle has `roughness 0.3`, the plane middle-right is experiencing TIR (the black color is due to there being no sky), and the plane on the right has `specular 0.00001 0.00001 0.00001` and is almost fully transparent. This scene was rendered with MIS at 2048spp.* 

## Depth of Field

(currently writing the writeup, give me 15 minutes if yuou see this, i'm so sorry)


## References

[^1]: Bruce Walter, Stephen R Marschner, Hongsong Li, and Kenneth E Torrance. 2007. Microfacet models for refraction through rough surfaces. In *Proceedings of the 18th Eurographics conference on Rendering Techniques*. 195â€“206. [https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html](https://www.cs.cornell.edu/~srm/publications/EGSR07-btdf.html).

[^2]: [https://en.wikipedia.org/wiki/Schlick's_approximation](https://en.wikipedia.org/wiki/Schlick's_approximation)
